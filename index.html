<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>التضخم ... قرن من الزمان </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN for charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* START: General Body Styles */
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #073B4C; /* Base background */
            color: #FFFFFF;
            padding-bottom: 100px; /* Add padding to body to prevent content from being hidden by fixed footer */
        }
        /* END: General Body Styles */

        /* START: Chart Container Styles */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Limits max width on large screens */
            margin-left: auto;
            margin-right: auto;
            height: 250px; /* Default height for mobile */
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px; /* Larger height for desktop */
            }
        }
        /* END: Chart Container Styles */

        /* START: Card Styles */
        .card {
            background-color: #118AB2;
            border-radius: 1rem;
            padding: 1rem; /* Adjusted padding for mobile */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        /* END: Card Styles */

        /* START: Highlight Colors */
        .highlight-yellow {
            color: #FFD166;
        }
        .highlight-red {
            color: #FF6B6B;
        }
        .highlight-green {
            color: #06D6A0;
        }
        /* END: Highlight Colors */

        /* START: Timeline Styles */
        .timeline {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center the vertical line */
            width: 100%;
            padding-top: 20px;
            padding-bottom: 20px;
        }
        .timeline::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%; /* Center the line */
            width: 4px;
            background-color: #118AB2;
            transform: translateX(-50%); /* Adjust for line width */
        }
        .timeline-item {
            position: relative;
            width: 100%; /* Full width on mobile, will be split on desktop */
            margin-bottom: 30px; /* Space between items */
            display: flex; /* Use flexbox for content and icon alignment */
        }
        .timeline-item:last-child {
            margin-bottom: 0;
        }
        /* Mobile-first: Default to right-aligned content */
        .timeline-item .timeline-content {
            background-color: #073B4C;
            border: 2px solid #118AB2;
            padding: 15px;
            border-radius: 10px;
            flex-grow: 1;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-right: 60px; /* Space for icon on the right */
            text-align: right; /* RTL alignment */
        }
        .timeline-item .timeline-icon {
            position: absolute;
            top: 0; /* Align icon to top of content */
            right: 0; /* Position icon on the right for RTL */
            width: 40px;
            height: 40px;
            background-color: #FFD166;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #073B4C;
            z-index: 10;
            transform: translateX(50%); /* Center icon on the line */
        }

        /* Desktop specific styles for alternating timeline */
        @media (min-width: 768px) {
            .timeline-item {
                width: 50%; /* Each item takes half width */
                margin-bottom: 40px;
            }
            .timeline-item:nth-child(odd) {
                /* Items on the right side */
                align-self: flex-end; /* Push to the right */
                padding-right: 40px; /* Space for icon and line */
                padding-left: 0; /* Reset left padding */
                text-align: right;
            }
            .timeline-item:nth-child(even) {
                /* Items on the left side */
                align-self: flex-start; /* Push to the left */
                padding-left: 40px; /* Space for icon and line */
                padding-right: 0; /* Reset right padding */
                text-align: left;
            }
            .timeline-item:nth-child(odd) .timeline-content {
                margin-right: 0; /* Reset margin */
                margin-left: auto; /* Push content to right within its 50% width */
                text-align: right;
            }
            .timeline-item:nth-child(even) .timeline-content {
                margin-left: 0; /* Reset margin */
                margin-right: auto; /* Push content to left within its 50% width */
                text-align: left;
            }
            .timeline-item:nth-child(odd) .timeline-icon {
                right: -22px; /* Position icon on the line */
                left: auto; /* Ensure no left positioning */
                transform: translateY(-50%) translateX(0%); /* Center vertically on desktop */
            }
            .timeline-item:nth-child(even) .timeline-icon {
                left: -22px; /* Position icon on the line */
                right: auto; /* Ensure no right positioning */
                transform: translateY(-50%) translateX(0%); /* Center vertically on desktop */
            }
            .timeline-content h5 {
                font-size: 1.25rem; /* text-xl for desktop */
            }
            .timeline-content p {
                font-size: 1rem; /* text-base for desktop */
            }
        }
        /* END: Timeline Styles */

        /* START: Input Group Styles */
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .input-group label {
            font-weight: bold;
            color: #FFD166;
        }
        .input-group input, .input-group select {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #118AB2;
            background-color: #FFFFFF; /* White background */
            color: #00008B; /* Dark blue text for maximum visibility */
            font-size: 1rem;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #FFD166;
            box-shadow: 0 0 0 2px rgba(255, 209, 102, 0.5);
        }
        /* END: Input Group Styles */

        /* START: Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 100; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #073B4C;
            margin: auto;
            padding: 2rem;
            border: 2px solid #118AB2;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            position: relative;
            text-align: center;
        }
        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: #FFD166;
            text-decoration: none;
            cursor: pointer;
        }
        .modal-button {
            background-color: #06D6A0;
            color: #073B4C;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 1rem;
        }
        .modal-button:hover {
            background-color: #05B38B;
        }
        .loading-spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #FFD166;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden {
            display: none;
        }
        /* END: Modal Styles */

        /* START: Section Specific Backgrounds */
        #the-silent-thief {
            background-color: #0A4E60; /* Slightly lighter teal */
            padding: 2rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
        }
        #the-secret-friend {
            background-color: #0A4E60; /* Changed to match #the-silent-thief */
            padding: 2rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
        }
        #the-solution {
            background-color: #0A4E60; /* Changed to match #the-silent-thief */
            padding: 2rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
        }
        /* END: Section Specific Backgrounds */

        /* START: Floating Buttons Container */
        .floating-buttons-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #073B4C; /* Match body background */
            padding: 1rem;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.3);
            z-index: 50; /* Ensure it's above other content but below modals */
            display: flex;
            justify-content: center;
            gap: 1rem; /* Space between buttons */
            flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
        }
        .floating-buttons-container button,
        .floating-buttons-container a {
            flex-grow: 1; /* Allow buttons to grow and fill space */
            max-width: 300px; /* Limit max width of each button */
            text-decoration: none; /* Remove underline from anchor tags */
            text-align: center; /* Center text in buttons/links */
            display: flex; /* Use flex for icon alignment */
            align-items: center;
            justify-content: center;
        }
        @media (min-width: 768px) {
            .floating-buttons-container {
                padding: 1.5rem;
            }
            .floating-buttons-container button,
            .floating-buttons-container a {
                flex-grow: 0; /* Don't grow on larger screens */
            }
        }
        /* END: Floating Buttons Container */

        /* START: Share Buttons Section */
        .share-buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .share-button {
            background-color: #118AB2;
            color: #FFFFFF;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background-color 0.3s ease;
        }
        .share-button:hover {
            background-color: #06D6A0;
        }
        /* END: Share Buttons Section */

        /* START: Discover More Section */
        .discover-more-card {
            background-color: #118AB2;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease-in-out, background-color 0.3s ease;
        }
        .discover-more-card:hover {
            transform: translateY(-5px);
            background-color: #0A4E60; /* Darker teal on hover */
        }
        /* END: Discover More Section */
    </style>
    <!-- START: Performance Tracking Placeholder -->
    <!-- في بيئة الإنتاج، يمكنك تضمين نصوص أدوات التحليل هنا. -->
    <!-- على سبيل المثال، Google Analytics: -->
    <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=YOUR_GA_TRACKING_ID"></script> -->
    <!-- <script> -->
    <!--    window.dataLayer = window.dataLayer || []; -->
    <!--    function gtag(){dataLayer.push(arguments);} -->
    <!--    gtag('js', new Date()); -->
    <!--    gtag('config', 'YOUR_GA_TRACKING_ID'); -->
    <!-- </script> -->
    <!-- لتحقيق أفضل أداء، فكر في استضافة هذه النصوص محليًا أو دمجها في عملية البناء الخاصة بك. -->
    <!-- END: Performance Tracking Placeholder -->
</head>
<body class="antialiased">

    <div class="container mx-auto p-4 md:p-8">

        <!-- START: Header Section -->
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl md:text-6xl font-black highlight-yellow mb-2">💸 الجنيه المصري: رحلة قرن</h1>
            <h2 class="text-xl md:text-4xl font-bold">التضخم في مصر من 1900 حتى 2025</h2>
            <p class="text-base md:text-xl mt-4 max-w-3xl mx-auto text-gray-300">
                "الجنيه مش دايم… التضخم هو اللي دايم!" هل تساءلت يوماً عن قيمة "جنيه" زمان؟ في هذا الإنفوجرافيك، نكشف رحلة الجنيه المصري وتأثير التضخم عليه، وكيف تحمي مدخراتك من الضياع!
                <br>
                <span class="text-sm text-red-300 font-bold">
                </span>
            </p>
        </header>
        <!-- END: Header Section -->

        <main>
            <!-- START: Part 1 - The Silent Thief Section -->
            <section id="the-silent-thief" class="mb-12 md:mb-16">
                <h3 class="text-2xl md:text-4xl font-bold text-center mb-6 md:mb-8"><span class="highlight-red">الجزء الأول:</span> سارق القوة الشرائية... كيف أكل التضخم الجنيه!</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8 mb-8 md:mb-12 text-center">
                    <div class="card">
                        <p class="text-4xl md:text-6xl font-black highlight-yellow">+39,000</p>
                        <p class="mt-1 text-sm md:text-lg">جنيه هي القوة الشرائية التقريبية لـ 100 جنيه من عام 1900 بعملة اليوم!</p>
                    </div>
                    <div class="card">
                        <p class="text-4xl md:text-6xl font-black highlight-yellow">+39,600%</p>
                        <p class="mt-1 text-sm md:text-lg">هو معدل التضخم التراكمي التقريبي منذ عام 1900.</p>
                    </div>
                    <div class="card">
                        <p class="text-4xl md:text-6xl font-black highlight-yellow">&gt;99%</p>
                        <p class="mt-1 text-sm md:text-lg">خسارة في القوة الشرائية لمن احتفظ بمدخراته "تحت البلاطة".</p>
                    </div>
                </div>

                <div class="card mb-8 md:mb-12">
                    <h4 class="text-xl md:text-2xl font-bold mb-3 text-center">المبلغ المطلوب للحفاظ على القوة الشرائية لمبلغ <span id="baseAmountDisplay">100</span> جنيه من سنة <span id="startYearDisplay">1900</span></h4>
                    <p class="text-center text-gray-300 text-sm md:text-base mb-4">هذا الرسم يوضح المبلغ الذي كنت ستحتاجه في كل عام للحفاظ على نفس القوة الشرائية لمبلغ <span id="baseAmountDisplay2">100</span> جنيه مصري من السنة التي تختارها.</p>
                    <div class="input-group max-w-xs mx-auto">
                        <label for="startYearInput" class="text-sm md:text-base">اختر سنة البداية للمقارنة:</label>
                        <select id="startYearInput" class="w-full mb-4" aria-label="اختر سنة البداية للمقارنة">
                            <!-- Options will be dynamically populated by JavaScript -->
                        </select>
                        <label for="baseAmountInput" class="text-sm md:text-base">أدخل المبلغ الأولي (جنيه):</label>
                        <input type="number" id="baseAmountInput" value="100" min="1" step="10" aria-label="أدخل المبلغ الأولي للجنيه المصري">
                    </div>
                    <div class="chart-container">
                        <!-- Changed from div to canvas for Chart.js -->
                        <canvas id="purchasingPowerChart" role="img" aria-label="رسم بياني يوضح القوة الشرائية للجنيه المصري عبر الزمن"></canvas>
                    </div>
                </div>
                
                <div class="relative wrap overflow-hidden p-4 md:p-10 h-full">
                    <h4 class="text-2xl md:text-3xl font-bold mb-6 md:mb-8 text-center">أبرز محطات تآكل الجنيه المصري</h4>
                    <div class="timeline" role="list">
                        <div class="timeline-item" role="listitem">
                            <div class="timeline-icon" role="img" aria-label="أيقونة مبنى حكومي">🏛️</div>
                            <div class="timeline-content">
                                <h5>1952: بداية التدخل الحكومي</h5>
                                <p>بعد ثورة يوليو، بدأت الدولة تتدخل في السوق وتدعم الأسعار بشكل مكثف، مما أثر على آليات السوق الطبيعية وأحدث خللاً اقتصاديًا على المدى الطويل.</p>
                            </div>
                        </div>
                        <div class="timeline-item" role="listitem">
                            <div class="timeline-icon" role="img" aria-label="أيقونة الكرة الأرضية">🌍</div>
                            <div class="timeline-content">
                                <h5>السبعينات: الانفتاح الاقتصادي غير المنظم</h5>
                                <p>شهدت هذه الفترة انفتاحًا اقتصاديًا سريعًا وغير مخطط له، ما أدى إلى قفزات سعرية مفاجئة وكبيرة في العديد من السلع والخدمات.</p>
                            </div>
                        </div>
                        <div class="timeline-item" role="listitem">
                            <div class="timeline-icon" role="img" aria-label="أيقونة سهم صاعد">📈</div>
                            <div class="timeline-content">
                                <h5>التسعينات: عصر الخصخصة والتعويم الجزئي</h5>
                                <p>بدأت سياسات الخصخصة، وبدأ الجنيه المصري في التعويم جزئيًا (تحديد سعره بناءً على العرض والطلب بشكل غير كامل)، مما أثر على استقراره.</p>
                            </div>
                        </div>
                        <div class="timeline-item" role="listitem">
                            <div class="timeline-icon" role="img" aria-label="أيقونة مكبر صوت">📣</div>
                            <div class="timeline-content">
                                <h5>2003: إشارات التعويم الكامل</h5>
                                <p>برز مصطلح "تعويم الجنيه" بقوة في النقاشات الاقتصادية، مما عكس تزايد الضغوط على العملة المحلية والحاجة إلى تحرير سعر الصرف.</p>
                            </div>
                        </div>
                         <div class="timeline-item" role="listitem">
                            <div class="timeline-icon" role="img" aria-label="أيقونة بنك">🏦</div>
                            <div class="timeline-content">
                                <h5>2016: التعويم الرسمي الشامل</h5>
                                <p>تم التعويم الرسمي الشامل للجنيه المصري، مما أدى إلى قفزة تاريخية في سعر الدولار وتآكل كبير ومفاجئ في قيمة العملة المحلية.</p>
                            </div>
                        </div>
                        <div class="timeline-item" role="listitem">
                            <div class="timeline-icon" role="img" aria-label="أيقونة سهم هابط">📉</div>
                            <div class="timeline-content">
                                <h5>2023: فخ الذعر المالي</h5>
                                <p>شهدت هذه الفترة ربطًا مباشرًا بين سعر الصرف والتضخم، حيث ارتفع سعر الدولار في السوق الموازية بشكل جنوني. هذا الهلع دفع الكثيرين لشراء أي أصول للحفاظ على قيمة مدخراتهم، حتى لو بأسعار مبالغ فيها. وعندما تم تخفيض الجنيه رسميًا، خسر من اشترى بأسعار مرتفعة، مؤكدًا أن قرارات الذعر المالي غالبًا ما تكون فخًا.</p>
                            </div>
                        </div>
                        <div class="timeline-item" role="listitem">
                            <div class="timeline-icon" role="img" aria-label="أيقونة سهم لأسفل">⬇️</div>
                            <div class="timeline-content">
                                <h5>يونيو 2025: بداية الانكماش وتأجيل الشراء</h5>
                                <p>بعد موجات تضخم عالية، شهد شهر يونيو 2025 تضخمًا شهريًا سلبيًا لأول مرة منذ أكثر من عام، مما أدى إلى انخفاض أسعار بعض السلع. هذه الظاهرة، المعروفة بالانكماش، دفعت المستهلكين إلى تأجيل قرارات الشراء، خوفًا من استمرار تراجع الأسعار، مما قد يؤدي إلى تباطؤ اقتصادي.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- END: Part 1 - The Silent Thief Section -->

            <!-- START: Part 2 - The Secret Friend Section -->
            <section id="the-secret-friend" class="mb-12 md:mb-16">
                <h3 class="text-2xl md:text-4xl font-bold text-center mb-6 md:mb-8"><span class="highlight-green">الجزء الثاني:</span> الصديق السري... فوائد التضخم المعتدل!</h3>
                <p class="text-center max-w-3xl mx-auto mb-8 text-gray-300 text-sm md:text-base">مفاجأة! التضخم ليس دائمًا شريراً. عندما يكون معتدلاً ومسيطرًا عليه (بمعدل 2-3% سنويًا)، يمكن أن يكون مفيدًا للاقتصاد. وكما يقول المثل: **"التضخم عامل زي الملح في الأكل… رشة بسيطة تفتح النفس. إنما كتير؟ يخليك ترمي الطبق كله!"**</p>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-8">
                    <div class="card" role="article" aria-labelledby="heading-stimulate-spending">
                         <p class="text-4xl mb-3" role="img" aria-label="أيقونة شخص يركض">🏃</p>
                        <h4 id="heading-stimulate-spending" class="font-bold text-lg md:text-xl mb-2 highlight-yellow">يحفز الإنفاق</h4>
                        <p class="text-gray-200 text-sm md:text-base">يشجع الأفراد على الشراء والاستثمار بدلاً من الاحتفاظ بالأموال التي تقل قيمتها بمرور الوقت، مما ينشط الدورة الاقتصادية.</p>
                    </div>
                    <div class="card" role="article" aria-labelledby="heading-adjust-wages">
                         <p class="text-4xl mb-3" role="img" aria-label="أيقونة مصافحة">🤝</p>
                        <h4 id="heading-adjust-wages" class="font-bold text-lg md:text-xl mb-2 highlight-yellow">يسهل تعديل الأجور</h4>
                        <p class="text-gray-200 text-sm md:text-base">يمنح الشركات مرونة لتعديل تكاليفها وأجورها بشكل تدريجي وسلس، مما يجنب الحاجة إلى تخفيض الرواتب بشكل مباشر.</p>
                    </div>
                    <div class="card" role="article" aria-labelledby="heading-ease-debt">
                         <p class="text-4xl mb-3" role="img" aria-label="أيقونة سلسلة">⛓️</p>
                        <h4 id="heading-ease-debt" class="font-bold text-lg md:text-xl mb-2 highlight-yellow">يخفف عبء الديون</h4>
                        <p class="text-gray-200 text-sm md:text-base">يقلل من القيمة الحقيقية للديون بمرور الوقت، مما يسهل على الأفراد والحكومات سداد قروضهم المستحقة.</p>
                    </div>
                    <div class="card" role="article" aria-labelledby="heading-maneuver-room">
                         <p class="text-4xl mb-3" role="img" aria-label="أيقونة ترس">⚙️</p>
                        <h4 id="heading-maneuver-room" class="font-bold text-lg md:text-xl mb-2 highlight-yellow">يمنح مرونة للسياسة النقدية</h4>
                        <p class="text-gray-200 text-sm md:text-base">يعطي البنك المركزي القدرة على خفض أسعار الفائدة بشكل فعال لتحفيز الاقتصاد في أوقات الركود، دون الوصول إلى فائدة صفرية.</p>
                    </div>
                </div>
            </section>
            <!-- END: Part 2 - The Secret Friend Section -->

            <!-- START: Part 3 - The Solution Section -->
            <section id="the-solution" class="mb-12 md:mb-16">
                <h3 class="text-2xl md:text-4xl font-bold text-center mb-6 md:mb-8"><span class="highlight-yellow">الجزء الثالث:</span> كيف تحمي مدخراتك من الذوبان؟</h3>
                <p class="text-center max-w-3xl mx-auto mb-8 text-gray-300 text-sm md:text-base">الخلاصة بسيطة: "اجعل فلوسك تجري أسرع من التضخم!". الاحتفاظ بالنقود كاش هو أكبر خسارة. إليك كيف تحمي نفسك:</p>

                <div class="card mb-8 md:mb-12">
                    <h4 class="text-xl md:text-2xl font-bold mb-3 text-center">مقارنة صادمة: 10,000 جنيه من عام 2000</h4>
                     <p class="text-center text-gray-300 text-sm md:text-base mb-4">هذا الرسم يوضح الفرق الهائل بين الاحتفاظ بمبلغ 10,000 جنيه "تحت البلاطة" واستثماره في الذهب منذ عام 2000 وحتى اليوم (يونيو 2025). لاحظ أن القيمة النقدية للمبلغ تعكس قوته الشرائية المتآكلة بناءً على بيانات التضخم التقديرية، بينما لو استثمر في الذهب لكانت قيمته اليوم حوالي **1.7 مليون جنيه**!</p>
                    <div class="chart-container">
                        <!-- Changed from div to canvas for Chart.js -->
                        <canvas id="investmentChart" role="img" aria-label="رسم بياني مقارن بين قيمة 10,000 جنيه مدخرة نقداً وقيمتها لو استثمرت في الذهب من عام 2000 حتى 2025"></canvas>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-8">
                    <div class="card" role="article" aria-labelledby="heading-gold">
                         <p class="text-4xl mb-3" role="img" aria-label="أيقونة ميدالية ذهبية">🥇</p>
                        <h4 id="heading-gold" class="font-bold text-lg md:text-xl mb-2 highlight-yellow">الذهب</h4>
                        <p class="text-gray-200 text-sm md:text-base">ملاذ آمن تاريخي يحافظ على قيمته على المدى الطويل ويتفوق على التضخم في كثير من الأحيان.</p>
                    </div>
                     <div class="card" role="article" aria-labelledby="heading-stable-currencies">
                         <p class="text-4xl mb-3" role="img" aria-label="أيقونة عملة الدولار">💵</p>
                        <h4 id="heading-stable-currencies" class="font-bold text-lg md:text-xl mb-2 highlight-yellow">العملات المستقرة</h4>
                        <p class="text-gray-200 text-sm md:text-base">تنويع المدخرات بعملات أجنبية قوية مثل الدولار يقلل من مخاطر تآكل قيمة العملة المحلية.</p>
                    </div>
                     <div class="card" role="article" aria-labelledby="heading-growing-assets">
                         <p class="text-4xl mb-3" role="img" aria-label="أيقونة سهم صاعد">📈</p>
                        <h4 id="heading-growing-assets" class="font-bold text-lg md:text-xl mb-2 highlight-yellow">الأصول النامية</h4>
                        <p class="text-gray-200 text-sm md:text-base">الاستثمار في العقارات، الأسهم، أو شهادات الاستثمار ذات العائد الحقيقي المرتفع.</p>
                    </div>
                    <div class="card" role="article" aria-labelledby="heading-invest-in-yourself">
                         <p class="text-4xl mb-3" role="img" aria-label="أيقونة رأس بشري مع ترس">🧠</p>
                        <h4 id="heading-invest-in-yourself" class="font-bold text-lg md:text-xl mb-2 highlight-yellow">استثمر في نفسك</h4>
                        <p class="text-gray-200 text-sm md:text-base">اكتساب مهارات جديدة أو العمل في مجالات تدر دخلاً بالعملة الصعبة هو أقوى استثمار على الإطلاق.</p>
                    </div>
                </div>

                <!-- START: Summary Section -->
                <div class="card mt-8 mb-8 md:mb-12 text-center" role="article" aria-labelledby="heading-financial-awareness">
                    <h4 id="heading-financial-awareness" class="text-xl md:text-2xl font-bold highlight-yellow mb-3">الخلاصة: الوعي المالي هو درعك الأقوى!</h4>
                    <p class="max-w-3xl mx-auto text-gray-300 text-sm md:text-base">الجنيه المصري مر برحلة مليئة بالتحديات. من تعلم من التاريخ، عرف أن القيمة الحقيقية ليست في عدد الجنيهات التي تملكها، بل في قوتها الشرائية. فهمك للتضخم هو درعك الأقوى لتحافظ على تعبك وشغلك. تذكر دائمًا: "فلوسك يجب أن تعمل أكثر منك… فإذا بقيت نائمة في حساب بعائد 10% بينما التضخم 30%، فأنت تخسر 20% من قيمتها كل سنة دون أن تدرك ذلك!"</p>
                </div>
                <!-- END: Summary Section -->
                
            </section>
            <!-- END: Part 3 - The Solution Section -->
        </main>

        <!-- START: Inflation Rate Section (Moved to the end) -->
        <section class="mb-12 md:mb-16" role="region" aria-labelledby="current-inflation-heading">
            <div class="card p-4 mb-8 text-center">
                <h3 id="current-inflation-heading" class="text-xl md:text-2xl font-bold highlight-yellow mb-2">معدل التضخم السنوي:</h3>
                <p id="currentInflationDate" class="text-lg md:text-xl font-bold text-gray-300 mb-2">آخر تحديث: <span id="dynamicUpdateDate">يونيو 2025</span></p>
                <div class="flex items-center justify-center gap-2">
                    <span id="inflationRateDisplay" class="text-2xl md:text-4xl font-black highlight-green">14.9</span>
                    <span class="text-2xl md:text-4xl font-black highlight-green">%</span>
                </div>
                <p class="text-sm text-gray-400 mt-2">
                    <span class="highlight-yellow">ملاحظة هامة:</span> هذا الرقم (14.9%) هو معدل تضخم توضيحي لنموذج البيانات، وقد لا يعكس آخر تحديث رسمي. للحصول على أحدث وأدق بيانات التضخم، يرجى الرجوع للمصادر الرسمية (مثل الجهاز المركزي للتعبئة العامة والإحصاء أو البنك المركزي المصري).
                </p>
            </div>
        </section>
        <!-- END: Inflation Rate Section -->

        <!-- START: Discover More Section -->
        <section class="mb-12 md:mb-16 text-center" role="region" aria-labelledby="discover-more-heading">
            <h3 id="discover-more-heading" class="text-2xl md:text-4xl font-bold highlight-yellow mb-6">استكشف المزيد: مواضيع متعمقة</h3>
            <p class="text-gray-300 text-base mb-8">هنا يمكنك العثور على مزيد من التفاصيل والمقارنات المتعمقة حول مواضيع التضخم والاستثمار.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="discover-more-card" id="deeperHistoryCard">
                    <h4 class="text-xl md:text-2xl font-bold highlight-yellow mb-2">مقارنات تاريخية أعمق للجنيه</h4>
                    <p class="text-gray-200 text-sm md:text-base">استكشف بيانات تاريخية مفصلة وتحديات اقتصادية أخرى أثرت على قيمة الجنيه.</p>
                    <button class="modal-button mt-4 bg-purple-500 hover:bg-purple-600 text-white">قريباً...</button>
                </div>
                <div class="discover-more-card" id="detailedAnalysisCard">
                    <h4 class="text-xl md:text-2xl font-bold highlight-yellow mb-2">تحليل مفصل لأنواع الاستثمار</h4>
                    <p class="text-gray-200 text-sm md:text-base">تعمق في فهم كيفية عمل الذهب، العملات المستقرة، العقارات، والأسهم كأدوات لحماية مدخراتك.</p>
                    <button class="modal-button mt-4 bg-purple-500 hover:bg-purple-600 text-white">قريباً...</button>
                </div>
            </div>
        </section>
        <!-- END: Discover More Section -->

        <!-- START: Share This Infographic Section -->
        <section class="mb-12 md:mb-16 text-center" role="region" aria-labelledby="share-infographic-heading">
            <h3 id="share-infographic-heading" class="text-2xl md:text-4xl font-bold highlight-yellow mb-6">شارك هذا الإنفوجرافيك:</h3>
            <p class="text-gray-300 text-base mb-4">انشر الوعي المالي مع أصدقائك وعائلتك!</p>
            <div class="share-buttons-container">
                <a href="https://wa.me/?text=الجنيه%20المصري:%20رحلة%20قرن%20بين%20اللص%20الصامت%20والصديق%20الخفي%0A%0Aتعرف%20على%20رحلة%20الجنيه%20وتأثير%20التضخم%20وكيف%20تحمي%20مدخراتك!%0A%0A[رابط%20الإنفوجرافيك%20هنا]" target="_blank" class="share-button bg-green-500 hover:bg-green-600">
                    <span class="text-xl">💬</span> واتساب
                </a>
                <a href="https://www.facebook.com/sharer/sharer.php?u=[رابط%20الإنفوجرافيك%20هنا]&quote=الجنيه%20المصري:%20رحلة%20قرن%20بين%20اللص%20الصامت%20والصديق%20الخفي.%20تعرف%20على%20تأثير%20التضخم%20وكيف%20تحمي%20مدخراتك!" target="_blank" class="share-button bg-blue-700 hover:bg-blue-800">
                    <span class="text-xl">👍</span> فيسبوك
                </a>
                <a href="https://twitter.com/intent/tweet?text=الجنيه%20المصري:%20رحلة%20قرن%20بين%20اللص%20الصامت%20والصديق%20الخفي.%20تعرف%20على%20تأثير%20التضخم%20وكيف%20تحمي%20مدخراتك!&url=[رابط%20الإنفوجرافيك%20هنا]" target="_blank" class="share-button bg-blue-400 hover:bg-blue-500">
                    <span class="text-xl">🐦</span> تويتر
                </a>
                <a href="mailto:?subject=الجنيه%20المصري:%20رحلة%20قرن%20بين%20اللص%20الصامت%20والصديق%20الخفي&body=مرحباً،%0A%0Aأردت%20أن%20أشاركك%20هذا%20الإنفوجرافيك%20المفيد%20عن%20رحلة%20الجنيه%20المصري%20وتأثير%20التضخم%20عليه،%20وكيف%20يمكنك%20حماية%20مدخراتك.%0A%0A[رابط%20الإنفوجرافيك%20هنا]%0A%0Aتحياتي،" class="share-button bg-red-500 hover:bg-red-600">
                    <span class="text-xl">📧</span> بريد إلكتروني
                </a>
            </div>
            <p class="text-sm text-gray-400 mt-4">
                <span class="highlight-yellow">ملاحظة:</span> يرجى استبدال "[رابط الإنفوجرافيك هنا]" بالرابط الفعلي لهذه الصفحة عند النشر.
            </p>
        </section>
        <!-- END: Share This Infographic Section -->

        <!-- START: Footer Section -->
        <footer class="text-center mt-12 md:mt-16 border-t-2 border-blue-800 pt-6 md:pt-8" role="contentinfo">
            <p class="text-sm mt-4 text-gray-400">تصميم وإعداد بواسطة: <span class="highlight-yellow">EcoVisionX</span></p>
            <div class="mt-4">
                <h5 class="text-xl font-bold highlight-yellow mb-2">تواصل معنا للحصول على نصيحة استثمارية مخصصة!</h5>
                <p class="text-base text-gray-300">
                    البريد الإلكتروني: <a href="mailto:info@ecovisionx.com" class="text-green-400 hover:underline">info@ecovisionx.com</a><br>
                    <a href="https://wa.me/201044141005" class="text-green-400 hover:underline">+20 104 414 1005</a>
                </p>
            </div>
            <div class="mt-6">
                <p class="text-lg font-bold highlight-yellow">هل لديك أي استفسارات أو ترغب في مشاركة تجربتك مع التضخم؟</p>
                <p class="text-base text-gray-300 mt-2">نحن هنا للمساعدة! لا تتردد في التواصل معنا عبر البريد الإلكتروني أو الواتساب المذكور أعلاه.</p>
            </div>
        </footer>
        <!-- END: Footer Section -->

    </div>

    <!-- START: Floating Buttons Container -->
    <div class="floating-buttons-container" role="navigation" aria-label="أدوات مالية">
        <button id="openInvestmentAdviceModal" class="bg-yellow-500 hover:bg-yellow-600 text-blue-900 font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out" aria-label="افتح نافذة نصيحة استثمارية مخصصة">
            ✨ احصل على نصيحة استثمارية مخصصة
        </button>
        <button id="openCertificateComparisonModal" class="bg-green-500 hover:bg-green-600 text-blue-900 font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out" aria-label="افتح نافذة مقارنة العوائد الاستثمارية">
            📊 قارن العوائد الاستثمارية
        </button>
        <button id="openLoanCalculatorModal" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out" aria-label="افتح نافذة حاسبة القروض بضمان الشهادة">
             حاسبة القروض بضمان الشهادة
        </button>
        <!-- NEW: Support Button -->
        <a href="https://your-donation-platform.com/your-profile" target="_blank" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out flex items-center justify-center" aria-label="ادعمنا عشان نكمل المشروع">
            💖 ادعمنا عشان نكمل!
        </a>
    </div>
    <!-- END: Floating Buttons Container -->

    <!-- START: Investment Advice Modal -->
    <div id="investmentAdviceModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="investment-advice-title">
        <div class="modal-content">
            <span class="close-button" id="closeInvestmentAdviceModalButton" aria-label="إغلاق نافذة نصيحة استثمارية">&times;</span>
            <h3 id="investment-advice-title" class="text-2xl font-bold mb-4 highlight-yellow">نصيحة استثمارية مخصصة</h3>
            
            <div class="input-group mb-4 text-right">
                <label for="riskTolerance" class="mb-2">تحمل المخاطر:</label>
                <select id="riskTolerance" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                    <option value="منخفض جداً">منخفض جداً</option>
                    <option value="منخفض">منخفض</option>
                    <option value="متوسط" selected>متوسط</option>
                    <option value="مرتفع">مرتفع</option>
                    <option value="مرتفع جداً">مرتفع جداً</option>
                </select>
            </div>
            
            <div class="input-group mb-4 text-right">
                <label for="investmentHorizon" class="mb-2">الأفق الاستثماري:</label>
                <select id="investmentHorizon" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                    <option value="أقل من سنة">أقل من سنة</option>
                    <option value="1-3 سنوات">1-3 سنوات</option>
                    <option value="3-5 سنوات" selected>3-5 سنوات</option>
                    <option value="أكثر من 5 سنوات">أكثر من 5 سنوات</option>
                </select>
            </div>

            <button id="getAdviceButton" class="modal-button w-full justify-center">
                احصل على النصيحة ✨
            </button>

            <div id="adviceResult" class="mt-6 text-right text-gray-200 text-base">
                <!-- LLM advice will be displayed here -->
            </div>
            <div id="loadingSpinner" class="loading-spinner hidden"></div>
        </div>
    </div>
    <!-- END: Investment Advice Modal -->

    <!-- START: Certificate Comparison Modal -->
    <div id="certificateComparisonModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="certificate-comparison-title">
        <div class="modal-content">
            <span class="close-button" id="closeCertificateComparisonModalButton" aria-label="إغلاق نافذة مقارنة عوائد الشهادات">&times;</span>
            <h3 id="certificate-comparison-title" class="text-2xl font-bold mb-4 highlight-yellow">📊 مقارنة عوائد الشهادات (3 سنوات)</h3>
            
            <p class="text-gray-300 text-sm mb-4">قارن بين سيناريوهين للشهادات الاستثمارية على مدار 3 سنوات.</p>

            <div id="certificateComparisonSection">
                <div class="input-group mb-4 text-right">
                    <label for="initialAmountComparison" class="mb-2">المبلغ الأولي (جنيه):</label>
                    <input type="number" id="initialAmountComparison" value="100000" min="100" step="1000" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                </div>

                <h4 class="text-xl font-bold mb-3 highlight-green text-right">السيناريو الأول: فائدة سنوية مباشرة (تصرف آخر السنة)</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="input-group mb-2 text-right">
                        <label for="annualDirectRateYear1" class="mb-1">السنة الأولى (%):</label>
                        <input type="number" id="annualDirectRateYear1" value="27" min="0" step="0.1" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                    </div>
                    <div class="input-group mb-2 text-right">
                        <label for="annualDirectRateYear2" class="mb-1">السنة الثانية (%):</label>
                        <input type="number" id="annualDirectRateYear2" value="24" min="0" step="0.1" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                    </div>
                    <div class="input-group mb-4 text-right">
                        <label for="annualDirectRateYear3" class="mb-1">السنة الثالثة (%):</label>
                        <input type="number" id="annualDirectRateYear3" value="22" min="0" step="0.1" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                    </div>
                    <div class="input-group mb-4 text-right">
                        <label for="payoutFrequencyScenario1" class="mb-2">وتيرة صرف الفائدة (السيناريو الأول):</label>
                        <select id="payoutFrequencyScenario1" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                            <option value="annually">سنوي</option>
                            <option value="semiannually">نصف سنوي</option>
                            <option value="quarterly">ربع سنوي</option>
                            <option value="monthly">شهري</option>
                        </select>
                    </div>
                </div>

                <h4 class="text-xl font-bold mb-3 highlight-green text-right">السيناريو الثاني: فائدة دورية مع إعادة استثمار</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="input-group mb-2 text-right">
                        <label for="periodicRateYear1" class="mb-1">السنة الأولى (%):</label>
                        <input type="number" id="periodicRateYear1" value="24" min="0" step="0.1" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                    </div>
                    <div class="input-group mb-2 text-right">
                        <label for="periodicRateYear2" class="mb-1">السنة الثانية (%):</label>
                        <input type="number" id="periodicRateYear2" value="20" min="0" step="0.1" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                    </div>
                    <div class="input-group mb-4 text-right">
                        <label for="periodicRateYear3" class="mb-1">السنة الثالثة (%):</label>
                        <input type="number" id="periodicRateYear3" value="18" min="0" step="0.1" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                    </div>
                    <div class="input-group mb-4 text-right">
                        <label for="payoutFrequency" class="mb-2">وتيرة صرف الفائدة الدورية (السيناريو الثاني):</label>
                        <select id="payoutFrequency" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                            <option value="monthly">شهري</option>
                            <option value="quarterly">ربع سنوي</option>
                            <option value="semiannually">نصف سنوي</option>
                            <option value="annually">سنوي</option>
                        </select>
                    </div>
                    <div class="input-group mb-4 text-right">
                        <label for="dailyReinvestmentRate" class="mb-1">فائدة إعادة الاستثمار اليومية (%):</label>
                        <input type="number" id="dailyReinvestmentRate" value="10" min="0" step="0.1" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                    </div>
                </div>

                <button id="calculateCertificates" class="modal-button w-full justify-center">
                    احسب عوائد الشهادات ✨
                </button>

                <div id="certificateComparisonResult" class="mt-6 text-right text-gray-200 text-base">
                    <!-- Certificate comparison results will be displayed here -->
                </div>
            </div>
            <div id="comparisonLoadingSpinner" class="loading-spinner hidden"></div>
        </div>
    </div>
    <!-- END: Certificate Comparison Modal -->

    <!-- START: Loan Calculator Modal -->
    <div id="loanCalculatorModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="loan-calculator-title">
        <div class="modal-content">
            <span class="close-button" id="closeLoanCalculatorModalButton" aria-label="إغلاق نافذة حاسبة القروض">&times;</span>
            <h3 id="loan-calculator-title" class="text-2xl font-bold mb-4 highlight-yellow">🏦 حاسبة القروض بضمان الشهادة</h3>
            <p class="text-gray-300 text-sm mb-4">احسب وضع القرض بضمان شهادتك. (تأكد من حساب عوائد الشهادات أولاً)</p>
            
            <div id="loanScenarioSection">
                <div class="input-group mb-4 text-right">
                    <label for="initialAmountLoan" class="mb-2">المبلغ الأولي للشهادة (جنيه):</label>
                    <input type="number" id="initialAmountLoan" value="100000" min="100" step="1000" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                </div>
                <div class="input-group mb-4 text-right">
                    <label for="loanCertType" class="mb-2">نوع الشهادة للقرض:</label>
                    <select id="loanCertType" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                        <option value="scenario1">السيناريو الأول (فائدة سنوية مباشرة)</option>
                        <option value="scenario2">السيناريو الثاني (فائدة دورية مع إعادة استثمار)</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="input-group mb-2 text-right">
                        <label for="loanAnnualRate" class="mb-1">فائدة القرض السنوية (%):</label>
                        <input type="number" id="loanAnnualRate" value="20" min="0" step="0.1" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                    </div>
                    <div class="input-group mb-4 text-right">
                        <label for="loanDailyReinvestmentRate" class="mb-1">فائدة إعادة الاستثمار اليومية (%):</label>
                        <input type="number" id="loanDailyReinvestmentRate" value="10" min="0" step="0.1" class="w-full p-2 rounded-lg bg-white text-gray-800 border border-gray-300">
                    </div>
                </div>

                <button id="calculateLoanScenarioButton" class="modal-button w-full justify-center">
                    احسب وضع القرض 🏦
                </button>

                <div id="loanScenarioResult" class="mt-6 text-right text-gray-200 text-base">
                    <!-- Loan scenario results and advice will be displayed here -->
                </div>
            </div>
            <div id="loanCalculatorLoadingSpinner" class="loading-spinner hidden"></div>
        </div>
    </div>
    <!-- END: Loan Calculator Modal -->

    <!-- START: Coming Soon Modal -->
    <div id="comingSoonModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="coming-soon-title">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('comingSoonModal')" aria-label="إغلاق نافذة قريباً">&times;</span>
            <h3 id="coming-soon-title" class="text-2xl font-bold mb-4 highlight-yellow">قريباً!</h3>
            <p class="text-lg">هذه الميزة قيد التطوير حالياً وستكون متاحة قريباً.</p>
        </div>
    </div>
    <!-- END: Coming Soon Modal -->

    <!-- START: Generic Action Modal (for "Support Us" button) -->
    <div id="genericActionModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="generic-action-title">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('genericActionModal')" aria-label="إغلاق النافذة">&times;</span>
            <h3 id="genericActionModalTitle" class="text-2xl font-bold mb-4 highlight-yellow"></h3>
            <p id="genericActionModalMessage" class="text-lg"></p>
        </div>
    </div>
    <!-- END: Generic Action Modal -->


    <script>
        // Helper function to show a modal
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex'; // Use flex to center content
            } else {
                console.error(`Modal with ID '${modalId}' not found.`);
            }
        }

        // Helper function to close a modal
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            } else {
                console.error(`Modal with ID '${modalId}' not found.`);
            }
        }

        // Event listeners for floating buttons
        document.getElementById('openInvestmentAdviceModal').addEventListener('click', () => {
            showModal('investmentAdviceModal');
        });

        document.getElementById('openCertificateComparisonModal').addEventListener('click', () => {
            showModal('certificateComparisonModal');
        });

        // Corrected: This button now opens the actual loan calculator modal
        document.getElementById('openLoanCalculatorModal').addEventListener('click', () => {
            showModal('loanCalculatorModal');
        });

        // New event listeners for "Discover More" cards
        document.getElementById('deeperHistoryCard').addEventListener('click', () => {
            showModal('comingSoonModal');
        });
        document.getElementById('detailedAnalysisCard').addEventListener('click', () => {
            showModal('comingSoonModal');
        });


        // The 'ادعمنا عشان نكمل!' button is an <a> tag in the provided HTML, so its click is handled by the browser.
        // If it were a <button> and needed JS functionality, it would be added here.
        // For now, it links to a placeholder URL.
        document.querySelector('.floating-buttons-container a').addEventListener('click', (event) => {
            // Prevent default behavior if you want to show a modal instead of navigating
            // event.preventDefault();
            const genericModal = document.getElementById('genericActionModal');
            if (genericModal) {
                document.getElementById('genericActionModalTitle').innerText = 'ادعمنا عشان نكمل!';
                document.getElementById('genericActionModalMessage').innerText = 'شكراً لاهتمامك! دعمك يساعدنا على الاستمرار في تقديم محتوى قيم.';
                showModal('genericActionModal');
            }
        });


        // Close buttons for specific modals
        document.getElementById('closeInvestmentAdviceModalButton').addEventListener('click', () => {
            closeModal('investmentAdviceModal');
        });
        document.getElementById('closeCertificateComparisonModalButton').addEventListener('click', () => {
            closeModal('certificateComparisonModal');
        });
        document.getElementById('closeLoanCalculatorModalButton').addEventListener('click', () => {
            closeModal('loanCalculatorModal');
        });

        // Close modals when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target == document.getElementById('comingSoonModal')) {
                closeModal('comingSoonModal');
            }
            if (event.target == document.getElementById('genericActionModal')) {
                closeModal('genericActionModal');
            }
            if (event.target == document.getElementById('investmentAdviceModal')) {
                closeModal('investmentAdviceModal');
            }
            if (event.target == document.getElementById('certificateComparisonModal')) {
                closeModal('certificateComparisonModal');
            }
            if (event.target == document.getElementById('loanCalculatorModal')) {
                closeModal('loanCalculatorModal');
            }
        });

        // Helper function to wrap long labels for Chart.js
        const wrapLabel = (label) => {
            const maxLength = 16;
            if (typeof label !== 'string' || label.length <= maxLength) {
                return label;
            }
            const words = label.split(' ');
            const lines = [];
            let currentLine = '';
            words.forEach(word => {
                if ((currentLine + ' ' + word).length > maxLength) {
                    lines.push(currentLine);
                    currentLine = word;
                } else {
                    currentLine += (currentLine ? ' ' : '') + word;
                }
            });
            lines.push(currentLine);
            return lines;
        };

        // Helper function for Chart.js tooltip titles
        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
                return label.join(' ');
            }
            return label;
        };
        
        let purchasingPowerChartInstance;
        let investmentChartInstance;

        // Global variables to store scenario results for loan calculation
        let scenario1CertData = { rates: [], payoutFrequency: '' };
        let scenario2CertData = { rates: [], payoutFrequency: '' };
        let finalAmountScenario1Global = 0;
        let finalAmountScenario2Global = 0;


        // Data for "Purchasing Power" - representing the multiplier needed relative to 1900
        // These values indicate how many times more money is needed in a given year to have the same purchasing power as 1 EGP in 1900.
        const purchasingPowerMultipliersFrom1900 = {
            labels: ['1900', '1952', '2016', 'يونيو 2025'],
            // Multiplier: (Value of 100 EGP from 1900 in 2025) / (Value of 100 EGP from Year X in 2025)
            // 1900: (40000 / 40000) = 1
            // 1952: (40000 / 10000) = 4
            // 2016: (40000 / 256) = 156.25
            // 2025: (40000 / 100) = 400
            multipliers: [1, 4, 156.25, 400] 
        };

        // Function to update the purchasing power chart based on user input (base amount and start year)
        const updatePurchasingPowerChart = () => {
            const baseAmountInput = document.getElementById('baseAmountInput');
            const startYearInput = document.getElementById('startYearInput');
            const baseAmountDisplay = document.getElementById('baseAmountDisplay');
            const baseAmountDisplay2 = document.getElementById('baseAmountDisplay2');
            const startYearDisplay = document.getElementById('startYearDisplay');

            if (!baseAmountInput || !startYearInput || !baseAmountDisplay || !baseAmountDisplay2 || !startYearDisplay) {
                console.error("Missing one or more required elements for purchasing power chart update.");
                return;
            }

            const baseAmount = parseFloat(baseAmountInput.value);
            const selectedStartYear = startYearInput.value;

            // Find the multiplier for the selected start year
            const startIndex = purchasingPowerMultipliersFrom1900.labels.indexOf(selectedStartYear);
            let startYearMultiplier = 1; // Default to 1 if not found or for 1900
            if (startIndex !== -1) {
                startYearMultiplier = purchasingPowerMultipliersFrom1900.multipliers[startIndex];
            }

            // Calculate scaled data based on the selected start year and base amount
            const scaledData = purchasingPowerMultipliersFrom1900.multipliers.map(multiplier => {
                // If the selected start year is 1900, the data is just multiplier * baseAmount
                // If the selected start year is later, we need to adjust the baseline.
                // The formula is: (current_year_multiplier / start_year_multiplier) * baseAmount
                return (multiplier / startYearMultiplier) * baseAmount;
            });

            // Update display spans
            baseAmountDisplay.textContent = new Intl.NumberFormat('ar-EG').format(baseAmount);
            baseAmountDisplay2.textContent = new Intl.NumberFormat('ar-EG').format(baseAmount);
            startYearDisplay.textContent = selectedStartYear; // Update the year in the title

            if (purchasingPowerChartInstance) {
                purchasingPowerChartInstance.data.labels = purchasingPowerMultipliersFrom1900.labels.map(wrapLabel);
                purchasingPowerChartInstance.data.datasets[0].data = scaledData;
                purchasingPowerChartInstance.update();
            }
        };

        // Data for "Shocking Comparison" - fixed values for 10,000 EGP in 2000
        const initialInvestmentData = {
            labels: ['ادخار نقدي "تحت البلاطة"', 'استثمار في الذهب'].map(wrapLabel),
            // For 10,000 EGP in 2000:
            // Cash value today (if 10,000 EGP cash in 2000 is 500 EGP today, then 10,000 EGP cash is 500 EGP today)
            originalCashValue: 500, 
            // Gold value today (10,000 EGP in 2000 = ~363.64 grams. 363.64 * 4750 EGP/gram = ~1,727,290 EGP)
            originalGoldValue: 1727290, 
            datasets: [{
                label: 'القيمة النهائية في 2025 (بالجنيه)',
                data: [],
                backgroundColor: ['#FF6B6B', '#06D6A0'],
                borderColor: ['#FF6B6B', '#06D6A0'],
                borderWidth: 1
            }]
        };

        // Initialize charts and set up event listeners when the window loads
        window.onload = function() {
            // Populate start year dropdown
            const startYearSelect = document.getElementById('startYearInput');
            const years = ['1900', '1952', '2016', 'يونيو 2025']; // Use the same labels as in data
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.innerText = year;
                if (year === '1900') { // Default to 1900
                    option.selected = true;
                }
                startYearSelect.appendChild(option);
            });


            // Initialize Purchasing Power Chart
            const ctxPurchasingPower = document.getElementById('purchasingPowerChart').getContext('2d');
            if (ctxPurchasingPower) {
                purchasingPowerChartInstance = new Chart(ctxPurchasingPower, {
                    type: 'line',
                    data: {
                        labels: purchasingPowerMultipliersFrom1900.labels.map(wrapLabel),
                        datasets: [{
                            label: 'المبلغ المطلوب (بالجنيه)',
                            data: [], // Data will be set by updatePurchasingPowerChart
                            borderColor: '#FFD166',
                            backgroundColor: 'rgba(255, 209, 102, 0.2)',
                            fill: true,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'المبلغ المطلوب للحفاظ على القوة الشرائية',
                                    color: '#FFFFFF'
                                },
                                ticks: { color: '#FFFFFF' }
                            },
                            x: {
                                ticks: { color: '#FFFFFF' }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#FFFFFF'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    title: tooltipTitleCallback
                                }
                            }
                        }
                    }
                });
            } else {
                console.error('Failed to get context for purchasingPowerChart.');
            }

            // Initialize Investment Chart with fixed data
            const ctxInvestment = document.getElementById('investmentChart').getContext('2d');
            if (ctxInvestment) {
                investmentChartInstance = new Chart(ctxInvestment, {
                    type: 'bar',
                    data: {
                        labels: initialInvestmentData.labels,
                        // Directly use the fixed values from initialInvestmentData
                        datasets: [{
                            label: 'القيمة النهائية في 2025 (بالجنيه)',
                            data: [initialInvestmentData.originalCashValue, initialInvestmentData.originalGoldValue], 
                            backgroundColor: ['#FF6B6B', '#06D6A0'],
                            borderColor: ['#FF6B6B', '#06D6A0'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: true,
                                type: 'logarithmic',
                                title: {
                                    display: true,
                                    text: 'القيمة بالجنيه (مقياس لوغاريتمي)',
                                    color: '#FFFFFF'
                                },
                                ticks: { 
                                    color: '#FFFFFF',
                                    callback: function(value, index, values) {
                                        if (value === 1000000 || value === 100000 || value === 10000 || value === 1000 || value === 100 || value === 10) {
                                            return new Intl.NumberFormat('ar-EG').format(value) + ' جنيه';
                                        }
                                        return ''; 
                                    }
                                }
                            },
                            y: {
                                ticks: { color: '#FFFFFF', font: { size: 14 } }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    title: tooltipTitleCallback,
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.x !== null) {
                                            label += new Intl.NumberFormat('ar-EG', { style: 'currency', currency: 'EGP' }).format(context.parsed.x);
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                console.error('Failed to get context for investmentChart.');
            }

            // Call initial updates for display spans
            const baseAmountInput = document.getElementById('baseAmountInput');
            const startYearInput = document.getElementById('startYearInput');
            
            // Add null checks for these elements as well, as they are accessed on load
            if (!baseAmountInput || !startYearInput) { console.error("FATAL ERROR: Missing input elements for charts."); return; }

            updatePurchasingPowerChart(); // Initial call to update chart and display spans

            // Event listeners for input fields
            baseAmountInput.addEventListener('input', updatePurchasingPowerChart);
            startYearInput.addEventListener('change', updatePurchasingPowerChart);

            // START: Gemini API Integration Logic for Investment Advice Modal
            const investmentAdviceModal = document.getElementById('investmentAdviceModal');
            const getAdviceButton = document.getElementById('getAdviceButton');
            const riskToleranceSelect = document.getElementById('riskTolerance');
            const investmentHorizonSelect = document.getElementById('investmentHorizon');
            const adviceResultDiv = document.getElementById('adviceResult');
            const loadingSpinner = document.getElementById('loadingSpinner');

            // Add null checks for these elements as well
            if (!investmentAdviceModal) { console.error("FATAL ERROR: Element with ID 'investmentAdviceModal' not found."); return; }
            if (!getAdviceButton) { console.error("FATAL ERROR: Element with ID 'getAdviceButton' not found."); return; }
            if (!riskToleranceSelect) { console.error("FATAL ERROR: Element with ID 'riskTolerance' not found."); return; }
            if (!investmentHorizonSelect) { console.error("FATAL ERROR: Element with ID 'investmentHorizon' not found."); return; }
            if (!adviceResultDiv) { console.error("FATAL ERROR: Element with ID 'adviceResult' not found."); return; }
            if (!loadingSpinner) { console.error("FATAL ERROR: Element with ID 'loadingSpinner' not found."); return; }


            getAdviceButton.addEventListener('click', async () => {
                const riskTolerance = riskToleranceSelect.value;
                const investmentHorizon = investmentHorizonSelect.value;

                adviceResultDiv.innerHTML = ''; // Clear previous advice
                loadingSpinner.classList.remove('hidden'); // Show loading spinner

                const prompt = `بصفتك مستشارًا مالياً في مصر، قدم نصيحة استثمارية موجزة لشخص لديه تحمل مخاطر ${riskTolerance} وأفق استثماري ${investmentHorizon}. ركز على الأصول التي تحمي من التضخم وتناسب السوق المصري. لا تذكر أي أرقام أو عوائد محددة.`;

                console.log('Sending prompt to Gemini API:', prompt); // Debugging: Log the prompt
                // Log environment variables for debugging API key issue
                console.log('__app_id:', typeof __app_id !== 'undefined' ? __app_id : 'undefined');
                console.log('__firebase_config:', typeof __firebase_config !== 'undefined' ? __firebase_config : 'undefined');
                console.log('__initial_auth_token:', typeof __initial_auth_token !== 'undefined' ? 'present' : 'undefined');


                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    // The Canvas environment injects the API key automatically when this is an empty string.
                    // If you are running this file directly from your desktop, you will need to
                    // obtain your own Gemini API key and insert it here:
                    const apiKey = ""; // IMPORTANT: If running locally, replace with your actual Gemini API key, e.g., "YOUR_GEMINI_API_KEY_KEY"
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    console.log('Gemini API response status:', response.status); // Debugging: Log response status
                    const result = await response.json();
                    console.log('Gemini API response data:', result); // Debugging: Log full response data
                    
                    if (response.ok && result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        adviceResultDiv.innerHTML = `<p>${text}</p>`;
                    } else {
                        let errorMessage = 'عذراً، لم أتمكن من الحصول على نصيحة استثمارية. يرجى المحاولة مرة أخرى.';
                        if (result.error && result.error.message) {
                            errorMessage = `خطأ من API: ${result.error.message}. يرجى التأكد من أن مفتاح API صحيح أو الاتصال بالدعم.`;
                        } else if (!response.ok) {
                            errorMessage = `خطأ في الشبكة أو الخادم: الحالة ${response.status}. يرجى التحقق من اتصالك بالإنترنت.`;
                        }
                        console.error('Gemini API returned an error or unexpected structure:', result); // More detailed error logging
                        adviceResultDiv.innerHTML = `<p class="text-red-400">${errorMessage}</p>`;
                    }
                } catch (error) {
                    console.error('Error calling Gemini API:', error); // Debugging: Log the actual error object
                    adviceResultDiv.innerHTML = '<p class="text-red-400">حدث خطأ أثناء جلب النصيحة الاستثمارية. يرجى التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.</p>';
                    } finally {
                    loadingSpinner.classList.add('hidden'); // Hide loading spinner
                }
            });
            // END: Gemini API Integration Logic for Investment Advice Modal

            // START: Certificate Comparison Modal Logic
            const certificateComparisonModal = document.getElementById('certificateComparisonModal');
            const certificateComparisonResultDiv = document.getElementById('certificateComparisonResult');
            const comparisonLoadingSpinner = document.getElementById('comparisonLoadingSpinner');
            const calculateCertificatesButton = document.getElementById('calculateCertificates');

            // Add null checks for these elements
            if (!certificateComparisonModal) { console.error("FATAL ERROR: Element with ID 'certificateComparisonModal' not found."); return; }
            if (!certificateComparisonResultDiv) { console.error("FATAL ERROR: Element with ID 'certificateComparisonResultDiv' not found."); return; }
            if (!comparisonLoadingSpinner) { console.error("FATAL ERROR: Element with ID 'comparisonLoadingSpinner' not found."); return; }
            if (!calculateCertificatesButton) { console.error("FATAL ERROR: Element with ID 'calculateCertificates' not found."); return; }


            // Helper to get number of payouts per year based on frequency
            const getPayoutPeriodsPerYear = (frequency) => {
                switch (frequency) {
                    case 'annually': return 1;
                    case 'semiannually': return 2;
                    case 'quarterly': return 4;
                    case 'monthly': return 12;
                    default: return 1; // Default to annually
                }
            };

            // Helper to translate frequency to Arabic
            const translateFrequencyToArabic = (frequency) => {
                switch (frequency) {
                    case 'annually': return 'سنوي';
                    case 'semiannually': return 'نصف سنوي';
                    case 'quarterly': return 'ربع سنوي';
                    case 'monthly': return 'شهري';
                    default: return '';
                }
            };

            // Function to calculate Scenario 1 and Scenario 2
            calculateCertificatesButton.addEventListener('click', () => {
                console.log("Calculate Certificates button clicked.");
                certificateComparisonResultDiv.innerHTML = '';
                comparisonLoadingSpinner.classList.remove('hidden');

                try {
                    const initialAmountComparisonInput = document.getElementById('initialAmountComparison');
                    if (!initialAmountComparisonInput) { throw new Error("Element with ID 'initialAmountComparison' not found."); }
                    
                    const annualDirectRateYear1Input = document.getElementById('annualDirectRateYear1');
                    if (!annualDirectRateYear1Input) { throw new Error("Element with ID 'annualDirectRateYear1' not found."); }
                    const annualDirectRateYear2Input = document.getElementById('annualDirectRateYear2');
                    if (!annualDirectRateYear2Input) { throw new Error("Element with ID 'annualDirectRateYear2' not found."); }
                    const annualDirectRateYear3Input = document.getElementById('annualDirectRateYear3');
                    if (!annualDirectRateYear3Input) { throw new Error("Element with ID 'annualDirectRateYear3' not found."); }
                    
                    const payoutFrequencyScenario1Select = document.getElementById('payoutFrequencyScenario1');
                    if (!payoutFrequencyScenario1Select) { throw new Error("Element with ID 'payoutFrequencyScenario1' not found."); }
                    
                    const periodicRateYear1Input = document.getElementById('periodicRateYear1');
                    if (!periodicRateYear1Input) { throw new Error("Element with ID 'periodicRateYear1' not found."); }
                    const periodicRateYear2Input = document.getElementById('periodicRateYear2'); // Corrected ID
                    if (!periodicRateYear2Input) { throw new Error("Element with ID 'periodicRateYear2' not found."); } 
                    const periodicRateYear3Input = document.getElementById('periodicRateYear3'); // Corrected ID
                    if (!periodicRateYear3Input) { throw new Error("Element with ID 'periodicRateYear3' not found."); } 
                    
                    const payoutFrequencySelect = document.getElementById('payoutFrequency');
                    if (!payoutFrequencySelect) { throw new Error("Element with ID 'payoutFrequency' not found."); }
                    
                    const dailyReinvestmentRateInput = document.getElementById('dailyReinvestmentRate');
                    if (!dailyReinvestmentRateInput) { throw new Error("Element with ID 'dailyReinvestmentRate' not found."); }

                    const initialAmount = parseFloat(initialAmountComparisonInput.value);
                    const annualDirectRates = [
                        parseFloat(annualDirectRateYear1Input.value),
                        parseFloat(annualDirectRateYear2Input.value),
                        parseFloat(annualDirectRateYear3Input.value)
                    ];
                    const periodicRates = [
                        parseFloat(periodicRateYear1Input.value),
                        parseFloat(periodicRateYear2Input.value), 
                        parseFloat(periodicRateYear3Input.value)  
                    ];
                    const payoutFrequencyScenario1 = payoutFrequencyScenario1Select.value;
                    const payoutFrequency = payoutFrequencySelect.value;
                    const dailyReinvestmentRate = parseFloat(dailyReinvestmentRateInput.value);

                    if (isNaN(initialAmount) || initialAmount <= 0 || 
                        annualDirectRates.some(isNaN) || periodicRates.some(isNaN) || isNaN(dailyReinvestmentRate)) {
                        throw new Error("الرجاء إدخال أرقام صحيحة لجميع حقول الشهادات.");
                    }

                    // Scenario 1 Calculation: Simple interest on principal, paid out periodically, then reinvested daily.
                    let totalReinvestedEarningsScenario1 = 0;
                    const dailyReinvestmentRateFactor = (1 + dailyReinvestmentRate / 100 / 365);
                    const payoutsPerYearScenario1 = getPayoutPeriodsPerYear(payoutFrequencyScenario1);
                    const daysBetweenPayoutsScenario1 = 365 / payoutsPerYearScenario1;

                    for (let year = 0; year < 3; year++) {
                        const currentAnnualRate = annualDirectRates[year];
                        const annualSimpleInterest = initialAmount * (currentAnnualRate / 100);
                        const payoutAmountPerPeriod = annualSimpleInterest / payoutsPerYearScenario1;
                        
                        if (isNaN(payoutAmountPerPeriod) || !isFinite(payoutAmountPerPeriod)) {
                            throw new Error(`خطأ في حساب الفائدة السنوية للسيناريو الأول في السنة ${year + 1}.`);
                        }

                        for (let i = 0; i < payoutsPerYearScenario1; i++) {
                            const daysToThisPayout = (year * 365) + ((i + 1) * daysBetweenPayoutsScenario1);
                            const daysRemainingForCompounding = (3 * 365) - daysToThisPayout;
                            const actualDaysRemaining = Math.max(0, daysRemainingForCompounding);
                            
                            const futureValueOfPayout = payoutAmountPerPeriod * Math.pow(dailyReinvestmentRateFactor, actualDaysRemaining);
                            if (isNaN(futureValueOfPayout) || !isFinite(futureValueOfPayout)) {
                                throw new Error(`خطأ في حساب القيمة المستقبلية للدفعة في السيناريو الأول، السنة ${year + 1}، الدفعة ${i + 1}.`);
                            }
                            totalReinvestedEarningsScenario1 += futureValueOfPayout;
                        }
                    }
                    finalAmountScenario1Global = initialAmount + totalReinvestedEarningsScenario1;
                    const roiScenario1 = ((finalAmountScenario1Global - initialAmount) / initialAmount) * 100;
                    const cagrScenario1 = (Math.pow(finalAmountScenario1Global / initialAmount, 1/3) - 1) * 100;

                    // Scenario 2 Calculation: Simple interest on principal, paid out periodically, then reinvested daily.
                    let totalReinvestedEarningsScenario2 = 0;
                    const payoutsPerYearScenario2 = getPayoutPeriodsPerYear(payoutFrequency);
                    const daysBetweenPayoutsScenario2 = 365 / payoutsPerYearScenario2;

                    for (let year = 0; year < 3; year++) {
                        const annualPeriodicRate = periodicRates[year];
                        const annualSimpleInterestForScenario2 = initialAmount * (annualPeriodicRate / 100); 
                        const payoutThisPeriod = annualSimpleInterestForScenario2 / payoutsPerYearScenario2;
                        
                        if (isNaN(payoutThisPeriod) || !isFinite(payoutThisPeriod)) {
                            throw new Error(`خطأ في حساب الفائدة السنوية للسيناريو الثاني في السنة ${year + 1}.`);
                        }

                        for (let i = 0; i < payoutsPerYearScenario2; i++) {
                            const daysToThisPayout = (year * 365) + ((i + 1) * daysBetweenPayoutsScenario2);
                            const daysRemainingForCompounding = (3 * 365) - daysToThisPayout;
                            const actualDaysRemaining = Math.max(0, daysRemainingForCompounding);

                            const futureValueOfPayout = payoutThisPeriod * Math.pow(dailyReinvestmentRateFactor, actualDaysRemaining);
                            if (isNaN(futureValueOfPayout) || !isFinite(futureValueOfPayout)) {
                                throw new Error(`خطأ في حساب القيمة المستقبلية للدفعة في السيناريو الثاني، السنة ${year + 1}، الدفعة ${i + 1}.`);
                            }
                            totalReinvestedEarningsScenario2 += futureValueOfPayout;
                        }
                    }
                    finalAmountScenario2Global = initialAmount + totalReinvestedEarningsScenario2;

                    const roiScenario2 = ((finalAmountScenario2Global - initialAmount) / initialAmount) * 100;
                    const cagrScenario2 = (Math.pow(finalAmountScenario2Global / initialAmount, 1/3) - 1) * 100;

                    // Get Arabic frequency for Scenario 1
                    const arabicPayoutFrequencyScenario1 = translateFrequencyToArabic(payoutFrequencyScenario1);
                    const arabicPayoutFrequencyScenario2 = translateFrequencyToArabic(payoutFrequency);


                    let resultHtml = `
                        <p class="mb-2">المبلغ الأولي: ${new Intl.NumberFormat('ar-EG', { style: 'currency', currency: 'EGP' }).format(initialAmount)}</p>
                        <p class="mb-2"><strong>العائد بعد 3 سنوات (السيناريو الأول - فائدة سنوية تصرف ${arabicPayoutFrequencyScenario1}):</strong></p>
                        <p class="text-lg font-bold highlight-yellow mb-2">${new Intl.NumberFormat('ar-EG', { style: 'currency', currency: 'EGP' }).format(finalAmountScenario1Global)}</p>
                        <p class="text-base mb-2">ROI: ${roiScenario1.toFixed(2)}%</p>
                        <p class="text-base mb-4">معدل العائد السنوي المكافئ (CAGR): ${cagrScenario1.toFixed(2)}%</p>

                        <p class="mb-2"><strong>العائد بعد 3 سنوات (السيناريو الثاني - فائدة دورية مع إعادة استثمار):</strong></p>
                        <p class="text-lg font-bold highlight-yellow mb-2">${new Intl.NumberFormat('ar-EG', { style: 'currency', currency: 'EGP' }).format(finalAmountScenario2Global)}</p>
                        <p class="text-base mb-2">ROI: ${roiScenario2.toFixed(2)}%</p>
                        <p class="text-base mb-4">معدل العائد السنوي المكافئ (CAGR): ${cagrScenario2.toFixed(2)}%</p>
                    `;

                    // Store all relevant data for loan calculation based on user's choice
                    scenario1CertData = { rates: annualDirectRates, payoutFrequency: payoutFrequencyScenario1 };
                    scenario2CertData = { rates: periodicRates, payoutFrequency: payoutFrequency };
                    
                    // Determine the best scenario between 1 and 2 (for display purposes only)
                    let bestScenarioText = '';
                    if (finalAmountScenario1Global > finalAmountScenario2Global) {
                        bestScenarioText = `السيناريو الأول (فائدة سنوية تصرف ${arabicPayoutFrequencyScenario1})`;
                    } else if (finalAmountScenario2Global > finalAmountScenario1Global) {
                        bestScenarioText = `السيناريو الثاني (فائدة دورية تصرف ${arabicPayoutFrequencyScenario2} مع إعادة استثمار)`;
                    } else {
                        bestScenarioText = 'كلا السيناريوهين متساويين في العائد';
                    }

                    resultHtml += `<p class="text-green-400 font-bold text-xl">أفضل سيناريو بين الشهادات: ${bestScenarioText}!</p>`;

                    certificateComparisonResultDiv.innerHTML = resultHtml;
                    console.log("Certificate comparison completed.");

                } catch (error) {
                    console.error("An error occurred during certificate comparison calculation:", error);
                    certificateComparisonResultDiv.innerHTML = `<p class="text-red-400">حدث خطأ أثناء حساب مقارنة الشهادات: ${error.message}. يرجى مراجعة المدخلات والمحاولة مرة أخرى.</p>`;
                } finally {
                    comparisonLoadingSpinner.classList.add('hidden');
                }
            });
            // END: Certificate Comparison Modal Logic

            // START: Loan Calculator Modal Logic
            const loanCalculatorModal = document.getElementById('loanCalculatorModal');
            const loanCalculatorLoadingSpinner = document.getElementById('loanCalculatorLoadingSpinner');
            const calculateLoanScenarioButton = document.getElementById('calculateLoanScenarioButton');
            const loanScenarioResultDiv = document.getElementById('loanScenarioResult');

            // Add null checks for these elements
            if (!loanCalculatorModal) { console.error("FATAL ERROR: Element with ID 'loanCalculatorModal' not found."); return; }
            if (!loanCalculatorLoadingSpinner) { console.error("FATAL ERROR: Element with ID 'loanCalculatorLoadingSpinner' not found."); return; }
            if (!calculateLoanScenarioButton) { console.error("FATAL ERROR: Element with ID 'calculateLoanCalculatorButton' not found."); return; }
            if (!loanScenarioResultDiv) { console.error("FATAL ERROR: Element with ID 'loanScenarioResultDiv' not found."); return; }

            // Elements within the loan calculator modal
            const initialAmountLoanInput = document.getElementById('initialAmountLoan');
            const loanCertTypeSelect = document.getElementById('loanCertType');
            const loanAnnualRateInput = document.getElementById('loanAnnualRate');
            const loanDailyReinvestmentRateInput = document.getElementById('loanDailyReinvestmentRate');

            if (!initialAmountLoanInput) { console.error("FATAL ERROR: Element with ID 'initialAmountLoan' not found."); return; }
            if (!loanCertTypeSelect) { console.error("FATAL ERROR: Element with ID 'loanCertType' not found."); return; }
            if (!loanAnnualRateInput) { console.error("FATAL ERROR: Element with ID 'loanAnnualRate' not found."); return; }
            if (!loanDailyReinvestmentRateInput) { console.error("FATAL ERROR: Element with ID 'loanDailyReinvestmentRate' not found."); return; }


            // Function to calculate Scenario 3 (Loan)
            calculateLoanScenarioButton.addEventListener('click', () => {
                console.log("Calculate Loan Scenario button clicked.");
                loanScenarioResultDiv.innerHTML = '';
                loanCalculatorLoadingSpinner.classList.remove('hidden');

                try {
                    const initialAmount = parseFloat(initialAmountLoanInput.value);
                    const loanAnnualRate = parseFloat(loanAnnualRateInput.value);
                    const dailyReinvestmentRate = parseFloat(loanDailyReinvestmentRateInput.value);
                    const loanCertType = loanCertTypeSelect.value; // Get selected certificate type for loan

                    if (isNaN(initialAmount) || initialAmount <= 0 || isNaN(loanAnnualRate) || isNaN(dailyReinvestmentRate)) {
                        throw new Error("الرجاء إدخال أرقام صحيحة لجميع حقول القرض وإعادة الاستثمار.");
                    }

                    let certRatesForLoan = [];
                    let certPayoutFrequencyForLoan = '';

                    if (loanCertType === 'scenario1') {
                        certRatesForLoan = scenario1CertData.rates;
                        certPayoutFrequencyForLoan = scenario1CertData.payoutFrequency;
                    } else if (loanCertType === 'scenario2') {
                        certRatesForLoan = scenario2CertData.rates;
                        certPayoutFrequencyForLoan = scenario2CertData.payoutFrequency;
                    }

                    if (certRatesForLoan.length === 0 || certPayoutFrequencyForLoan === '') {
                        throw new Error("يرجى حساب مقارنة الشهادات أولاً في النافذة الأخرى لتحديد نوع الشهادة للقرض.");
                    }

                    const certPeriodsPerYearForLoan = getPayoutPeriodsPerYear(certPayoutFrequencyForLoan);
                    
                    // Scenario 3 Calculation: Certificate with loan, periodic payouts, and reinvestment of net cash flow
                    let totalReinvestedSurplusesScenario3 = 0;
                    let totalUserContributionScenario3 = 0;
                    const loanPrincipal = initialAmount * 0.90; // 90% of certificate value
                    const loanTermMonths = 3 * 12; // 3 years fixed
                    const loanMonthlyRate = loanAnnualRate / 100 / 12;

                    let monthlyLoanInstallment = 0;
                    if (loanMonthlyRate > 0) {
                        monthlyLoanInstallment = (loanPrincipal * loanMonthlyRate) / (1 - Math.pow(1 + loanMonthlyRate, -loanTermMonths));
                    } else {
                        monthlyLoanInstallment = loanPrincipal / loanTermMonths;
                    }
                    
                    if (isNaN(monthlyLoanInstallment) || !isFinite(monthlyLoanInstallment)) {
                        throw new Error("خطأ في حساب قسط القرض الشهري. يرجى مراجعة نسبة فائدة القرض.");
                    }
                    console.log(`Scenario 3 - Loan Principal: ${loanPrincipal.toFixed(2)}, Monthly Loan Rate: ${(loanMonthlyRate*100).toFixed(4)}%, Monthly Installment: ${monthlyLoanInstallment.toFixed(2)}`);
                    
                    const dailyReinvestmentRateFactor = (1 + dailyReinvestmentRate / 100 / 365);


                    // Monthly loop for 3 years (36 months)
                    for (let month = 0; month < loanTermMonths; month++) {
                        const currentYearIndex = Math.floor(month / 12);
                        // Ensure currentYearIndex does not exceed array bounds
                        if (currentYearIndex >= certRatesForLoan.length) {
                            console.warn(`Year index ${currentYearIndex} out of bounds for certRatesForLoan. Using last available rate.`);
                            // Fallback to the last available rate if year index is out of bounds
                            certRatesForLoan[currentYearIndex] = certRatesForLoan[certRatesForLoan.length - 1];
                        }
                        const currentAnnualCertRate = certRatesForLoan[currentYearIndex]; // Certificate rate from selected scenario

                        let periodicCertIncome = 0;
                        // Check if it's a payout period for the certificate
                        if (certPeriodsPerYearForLoan > 0 && (month % (12 / certPeriodsPerYearForLoan) === 0)) {
                            periodicCertIncome = initialAmount * (currentAnnualCertRate / 100) / certPeriodsPerYearForLoan;
                        }
                        if (isNaN(periodicCertIncome) || !isFinite(periodicCertIncome)) {
                            throw new Error(`خطأ في حساب العائد الدوري للشهادة في السيناريو الثالث، الشهر ${month + 1}.`);
                        }

                        const netCashFlowThisMonth = periodicCertIncome - monthlyLoanInstallment;

                        console.log(`Scenario 3 - Month ${month + 1}: Cert Income = ${periodicCertIncome.toFixed(2)}, Loan Installment = ${monthlyLoanInstallment.toFixed(2)}, Net Cash Flow = ${netCashFlowThisMonth.toFixed(2)}`);

                        if (netCashFlowThisMonth > 0) {
                            // Surplus: Reinvest this amount daily from this month until the end of 3 years
                            const daysPassed = (month + 1) * (365 / 12); // Approximate days passed until end of this month
                            const daysRemainingForCompounding = (3 * 365) - daysPassed;
                            const actualDaysRemaining = Math.max(0, daysRemainingForCompounding);
                            
                            const futureValueOfSurplus = netCashFlowThisMonth * Math.pow(dailyReinvestmentRateFactor, actualDaysRemaining);
                            if (isNaN(futureValueOfSurplus) || !isFinite(futureValueOfSurplus)) {
                                throw new Error(`خطأ في حساب القيمة المستقبلية للفائض في السيناريو الثالث، الشهر ${month + 1}.`);
                            }
                            totalReinvestedSurplusesScenario3 += futureValueOfSurplus;
                            console.log(`  Surplus Reinvested: Days Remaining = ${actualDaysRemaining.toFixed(0)}, FV of Surplus = ${futureValueOfSurplus.toFixed(2)}`);
                        } else {
                            // Deficit: User adds this amount from pocket
                            totalUserContributionScenario3 += Math.abs(netCashFlowThisMonth);
                            console.log(`  Deficit: User contributes ${Math.abs(netCashFlowThisMonth).toFixed(2)}`);
                        }
                    }

                    const finalAmountScenario3 = initialAmount + totalReinvestedSurplusesScenario3; // Certificate principal returned + reinvested surpluses
                    const totalInvestmentScenario3 = initialAmount + totalUserContributionScenario3; // Initial certificate + user's added money

                    if (totalInvestmentScenario3 <= 0) {
                        throw new Error("إجمالي الاستثمار للسيناريو الثالث غير صالح للحساب (قد يكون صفر أو أقل).");
                    }

                    const roiScenario3 = ((finalAmountScenario3 - totalInvestmentScenario3) / totalInvestmentScenario3) * 100;
                    const cagrScenario3 = (Math.pow(finalAmountScenario3 / totalInvestmentScenario3, 1/3) - 1) * 100;
                    console.log("Scenario 3 Results:", { finalAmountScenario3: finalAmountScenario3.toFixed(2), totalUserContributionScenario3: totalUserContributionScenario3.toFixed(2), roiScenario3: roiScenario3.toFixed(2), cagrScenario3: cagrScenario3.toFixed(2) });

                    // Get Arabic frequency for the selected loan certificate type
                    const arabicLoanCertPayoutFrequency = translateFrequencyToArabic(certPayoutFrequencyForLoan);

                    let loanResultHtml = `
                        <p class="mb-2"><strong>العائد بعد 3 سنوات (السيناريو الثالث - شهادة بقرض بضمان شهادة تصرف ${arabicLoanCertPayoutFrequency}):</strong></p>
                        <p class="text-lg font-bold highlight-yellow mb-2">${new Intl.NumberFormat('ar-EG', { style: 'currency', currency: 'EGP' }).format(finalAmountScenario3)}</p>
                        <p class="text-base mb-2">إجمالي مساهمة المستخدم الإضافية: ${new Intl.NumberFormat('ar-EG', { style: 'currency', currency: 'EGP' }).format(totalUserContributionScenario3.toFixed(2))}</p>
                        <p class="text-base mb-2">ROI: ${roiScenario3.toFixed(2)}%</p>
                        <p class="text-base mb-4">معدل العائد السنوي المكافئ (CAGR): ${cagrScenario3.toFixed(2)}%</p>
                    `;

                    // Provide advice on whether to take the loan
                    const maxFinalAmountOfCertificates = Math.max(finalAmountScenario1Global, finalAmountScenario2Global);
                    let loanAdvice = '';

                    // Compare the final value of scenario 3 against the best of scenario 1/2
                    if (finalAmountScenario3 > maxFinalAmountOfCertificates && totalUserContributionScenario3 <= (initialAmount * 0.05)) { // Small user contribution tolerance
                        loanAdvice = '<p class="text-green-400 font-bold text-xl">نصيحة: أخذ القرض في هذا السيناريو قد يكون مفيداً، حيث أدى إلى عائد نهائي أعلى مع مساهمة إضافية محدودة.</p>';
                    } else if (finalAmountScenario3 > maxFinalAmountOfCertificates && totalUserContributionScenario3 > (initialAmount * 0.05)) {
                        loanAdvice = '<p class="text-yellow-400 font-bold text-xl">نصيحة: أخذ القرض في هذا السيناريو أدى إلى عائد نهائي أعلى، ولكن تطلب مساهمة إضافية كبيرة. يرجى مراجعة قدرتك على تغطية هذه المساهمات.</p>';
                    }
                    else if (finalAmountScenario3 < maxFinalAmountOfCertificates) {
                        loanAdvice = '<p class="text-red-400 font-bold text-xl">نصيحة: أخذ القرض في هذا السيناريو أدى إلى عائد نهائي أقل. قد لا يكون الخيار الأمثل لك.</p>';
                    } else {
                        loanAdvice = '<p class="text-gray-400 font-bold text-xl">نصيحة: العائد من هذا السيناريو قريب من أفضل سيناريوهات الشهادات الأخرى. يرجى مراجعة التفاصيل لاتخاذ القرار.</p>';
                    }

                    loanResultHtml += loanAdvice;
                    loanScenarioResultDiv.innerHTML = loanResultHtml;
                    console.log("Loan scenario calculation completed and advice displayed.");

                } catch (error) {
                    console.error("An error occurred during loan scenario calculation:", error);
                    loanScenarioResultDiv.innerHTML = `<p class="text-red-400">حدث خطأ أثناء حساب وضع القرض: ${error.message}. يرجى مراجعة المدخلات والمحاولة مرة أخرى.</p>`;
                } finally {
                    loanCalculatorLoadingSpinner.classList.add('hidden');
                }
            });
            // END: Loan Calculator Modal Logic
        };
    </script>
</body>
</html>
